<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <title>Ping-Pong Turnaj</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    html,
    body {
      height: 100%;
      width: 100%;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;

      background-image: url('background.jpg');
      background-size: cover;
      /* roztáhne na celou obrazovku */
      background-repeat: no-repeat;
      /* nezopakuje */
      background-position: center center;
      /* zarovná na střed */
      background-attachment: fixed;
      /* pozadí se neposouvá při scrollování */

      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }



    h1 {
     /* background: linear-gradient(135deg, #00454e, #668d97);*/
      color: #333;
      padding: 1rem;
      text-align: center;
      text-shadow: 0 0 20px rgb(255, 255, 255);
      /*box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);*/
      border-radius: 8px;
    }

    h2 {
      margin-top: 30px;
      font-size: 2.5rem;
      max-height: 20px;
      color: #000000;
      text-shadow: 0 0 20px rgb(255, 255, 255);
    }
    h3 {
      text-align: center;
      margin-top: 30px;
      font-size: 1.5rem;
      max-height: 20px;
      text-shadow: 0 0 20px rgb(0, 0, 0);
      color: #ffffff;
    }

    h4 {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 1.5rem;
      color: rgb(0, 0, 0);
      text-shadow: 0 0 10px rgb(255, 255, 255);
    }

    .menu {
      display: flex;
      gap: 20px;
      margin: 10px 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 50px 40px;
      font-size: 1.5rem;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #8af2fd, #008897);
      text-shadow: 0 0 10px rgba(0, 0, 0, 1);
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn:hover {
      background: linear-gradient(135deg, #008897, #8af2fd);
      text-shadow: 0 0 10px rgb(255, 255, 255);
      color: rgb(0, 0, 0);
    }

    .btn1 {
      padding: 10px 100px;
      font-size: 1.5rem;
      border: none;
      border-radius: 10px;
      background-color: #0097a7;
      color: white;
      cursor: pointer;
      opacity: 0.01;
      transition: background 0.3s;
    }

    .back-btn {
      padding: 50px 80px;
      font-size: 1.5rem;
      border: none;
      border-radius: 10px;
      margin-top: 20px;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      /*background-color: #ef5350;*/
      background: linear-gradient(135deg, #ac0000, #fd8a8a);
    }
    .back-btn:hover {
    /*  background-color: #006064;*/
      background: linear-gradient(135deg, #fd8a8a, #ac0000);
      text-shadow: 0 0 10px rgb(255, 255, 255);
      color: rgb(0, 0, 0);
    }

    .section {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 90%;
      max-width: 600px;
      background: rgb(42, 81, 99);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      opacity: 0.8;
    }

    .form-group {
      margin: 15px 0;
      width: 100%;
    }

    input,
    select {
      width: 65%;
      padding: 5px;
      font-size: 1.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      
    }

    .score-inputs {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      width: 100%;      
    }

    .score-container {
      display: flex;
      width: 100%;
      margin: 0 auto; /* vystředění celého bloku */
    }

    .score-label {
      flex: 0.8; /* každý zabere 50 % z těch 80 % */
      display: flex;
      justify-content: center; /* horizontální centrování */
      align-items: left;     /* vertikální centrování */
      border: 0px solid #ccc;  /* volitelné: pro viditelnou buňku */
      box-sizing: border-box;
      margin:  10px;
      width: 100%;
    }


    .turnaj-tabulka {
      width: 100%;
      border-collapse: collapse;
      background: linear-gradient(to right, #f8f9fa, #e9ecef);
      font-family: sans-serif;
      border: none;
      opacity: 0.8;
    }
  
    .turnaj-tabulka th, .turnaj-tabulka td {
      text-align: left;
      padding: 12px;
      border: none;
    }
  
    .turnaj-tabulka th {
      background-color: #343a40;
      color: rgb(190, 177, 177);

    }
  
    .turnaj-tabulka tr:nth-child(even) {
      background-color: rgb(190, 177, 177);

    }
  
    .turnaj-tabulka tr:hover {
      background-color: #ddd;

    }


    .keyboard {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100vw;
  height: 40vh;
  background-color: #222;
  color: white;
  display: none;
  flex-direction: column;
  padding: 10px;
  box-sizing: border-box;
  z-index: 1000;
}

.keyboard.visible {
  display: flex;
}

.keyboard-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(4vw, 1fr));
  gap: 5px;
  margin-bottom: 5px;
}

.keyboard button {
  padding: 1.5vh;
  font-size: 2vh;
  border: none;
  background-color: #444;
  color: white;
  border-radius: 6px;
  cursor: pointer;
  width: 100%;
}

.keyboard button:active {
  background-color: #666;
}

.wide {
  grid-column: span 2;
}
.extra-wide {
  grid-column: span 3;
}

  </style>

  </style>
</head>

<body onload="load();">

  <div class="menu">
    <button class="btn" onclick="zobraz('registrace')">Registrace hráče</button>
    <button class="btn" onclick="zobraz('skupinaA')">Zápas - Dospělí</button>
    <button class="btn" onclick="zobraz('skupinaB')">Zápas - Děti</button>
  </div>
  
  <!-- Sekce: Registrace -->
  <div id="registrace" class="section">
    <h2>Registrace hráče</h2>
    <div class="form-group score-inputs">
      <h4>Jméno:</h4>
      <input type="text" inputmode="text" id="jmeno">
    </div>
    <div class="form-group score-inputs">
      <h4>Příjmení:</h4>
      <input type="text" inputmode="text" id="prijmeni">
    </div>
    <div class="form-group score-inputs">
      <h4>Skupina:</h4>
      <select id="skupina">
        <option>Dospělí</option>
        <option>Děti</option>
      </select>
    </div>
    <button class="btn" onclick="ulozHrace()">Uložit hráče</button>
    <button class="btn back-btn" onclick="zpet()">Zpět</button>
  </div>

  <!-- Sekce: Zápasy -->
  <div id="skupinaA" class="section">
    <h2>Zápas - Dospělí</h2>
    <div class="score-container">
      <div class="form-group score-label">
        <h4>Hráč 1:</h4>
      </div>
      <div class="form-group score-label">
        <h4>Hráč 2:</h4>
      </div>
    </div>
    <div class="form-group score-inputs">
      <select id="hrac1A"></select>
      <select id="hrac2A"></select>
    </div>

    <div class="score-container">
      <div class="form-group score-label">
        <h4>První set:</h4>
      </div>
      <div class="form-group score-label">
        <h4>Druhý set:</h4>
      </div>
    </div>
    <div class="form-group score-inputs">
      <input type="number" inputmode="number" min="0" max="11" id="skore1A" placeholder="Skóre hráče 1">
      <input type="number" inputmode="number" min="0" max="11" id="skore2A" placeholder="Skóre hráče 2">
    </div>
    <div class="form-group score-inputs">
      <input type="number" inputmode="number" min="0" max="11" id="skore3A" placeholder="Skóre hráče 1">
      <input type="number" inputmode="number" min="0" max="11" id="skore4A" placeholder="Skóre hráče 2">
    </div>

    <button class="btn" onclick="ulozZapas('skupinaA')">Uložit zápas</button>
    <button class="btn back-btn" onclick="zpet()">Zpět</button>
  </div>


  <div id="skupinaB" class="section">
    <h2>Zápas - Děti</h2>
    <div class="score-container">
      <div class="form-group score-label">
        <h4>Hráč 1:</h4>
      </div>
      <div class="form-group score-label">
        <h4>Hráč 2:</h4>
      </div>
    </div>
    <div class="form-group score-inputs">
      <select id="hrac1B"></select>
      <select id="hrac2B"></select>
    </div>

    <div class="score-container">
      <div class="form-group score-label">
        <h4>První set:</h4>
      </div>
      <div class="form-group score-label">
        <h4>Druhý set:</h4>
      </div>
    </div>
    <div class="form-group score-inputs">
      <input type="number" inputmode="number" id="skore1B" placeholder="Skóre hráče 1">
      <input type="number" inputmode="number" id="skore2B" placeholder="Skóre hráče 2">
    </div>
    <div class="form-group score-inputs">
      <input type="number" inputmode="number" id="skore3B" placeholder="Skóre hráče 1">
      <input type="number" inputmode="number" id="skore4B" placeholder="Skóre hráče 2">
    </div>

    <button class="btn" onclick="ulozZapas('skupinaB')">Uložit zápas</button>
    <button class="btn back-btn" onclick="zpet()">Zpět</button>
  </div>


  <h1 >Ping-pong Turnaj</h1>
  <button class="btn1" id="btnVysledky" onclick="toggleVysledky()">Zobrazit výsledky</button>

  <div id="vysledky" style="display: none; padding: 2rem;">
    <h3>Výsledky Dospělí</h3>
    <table id="tabulkaA" class="turnaj-tabulka"  border="0"></table>

    <h3>Výsledky Děti</h3>
    <table id="tabulkaB" class="turnaj-tabulka" border="0"></table>
  </div>

  <!-- ************************************************************************************ -->
  <h2>Statistiky hráčů – Dospělí</h2>
  <table id="statistikyDospelem" border="1" class="turnaj-tabulka" style="border-collapse: collapse; width: 50%;">
    <thead>
      <tr>
        <th>Hráč</th>
        <th>Odehrané zápasy</th>
        <th>Zbývající zápasy</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table> 


  <h2>Statistiky hráčů – Děti</h2>
  <table id="statistikyDeti" border="1" class="turnaj-tabulka" style="border-collapse: collapse; width: 50%;">
    <thead>
      <tr>
        <th>Hráč</th>
        <th>Odehrané zápasy</th>
        <th>Zbývající zápasy</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <!-- ************************************************************************************ -->

  <div id="zpravaUlozeno" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #4caf50;
  color: white;
  padding: 60px 80px;
  border-radius: 10px;
  font-size: 32px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  z-index: 1000;
">
  Zápas uložen!
</div>

  <script>

    if ("virtualKeyboard" in navigator) {
      navigator.virtualKeyboard.overlaysContent = true;
    
      navigator.virtualKeyboard.addEventListener("geometrychange", (event) => {
        const { x, y, width, height } = event.target.boundingRect;
      });
    }


    function ulozHrace() {
      const jmeno = document.getElementById('jmeno').value.trim();
      const prijmeni = document.getElementById('prijmeni').value.trim();
      const skupina = document.getElementById('skupina').value;
      if (!jmeno || !prijmeni) return zobrazZpravu('Vyplňte jméno i příjmení!',true);//alert('Vyplňte jméno i příjmení');
  
      let hraci = JSON.parse(localStorage.getItem('hraci') || '[]');
      hraci.push({ jmeno, prijmeni, skupina });
      localStorage.setItem('hraci', JSON.stringify(hraci));
      //alert('Hráč uložen!');
      document.getElementById('jmeno').value = '';
      document.getElementById('prijmeni').value = '';
      naplnCombo('Dospělí');
      naplnCombo('Děti');
      const hrac = getHraceFromLocalStorage();  // Načti hráče z localStorage
      zobrazStatistiky(hrac, 'Děti', 'statistikyDeti');
      zobrazStatistiky(hrac, 'Dospělí', 'statistikyDospelem');
      zobrazZpravu('Hráč uložen!');
    }
  
    function naplnCombo(skupina) {
 
      if (skupina === 'Dospělí') {
        skupina = 'A';
      } else if (skupina === 'Děti') {
        skupina = 'B';
      }
      console.log('hrac1' + skupina);
      
      let hraci = JSON.parse(localStorage.getItem('hraci') || '[]');
      const combo1 = document.getElementById('hrac1' + skupina);
      const combo2 = document.getElementById('hrac2' + skupina);
  
      // vyčistit comboboxy
      //combo1.innerHTML = ' ';
      combo1.options.length = 0;
      //combo2.innerHTML = ' ';
      combo2.options.length = 0;

      if (skupina === 'A') {
        skupina = 'Dospělí';
      } else if (skupina === 'B') {
        skupina = 'Děti';
      }

      hraci.filter(h => h.skupina === skupina).forEach(h => {
        const celeJmeno = h.prijmeni + ' ' + h.jmeno;
        let opt1 = document.createElement('option');
        opt1.textContent = celeJmeno;
        combo1.appendChild(opt1);
  
        let opt2 = document.createElement('option');
        opt2.textContent = celeJmeno;
        combo2.appendChild(opt2);
      });
    }

    function ulozZapas(skupina) {

      console.log('ulozZapas - ' + skupina);
      
      const id1 = skupina === 'skupinaA' ? 'A' : 'B';

      const h1Select = document.getElementById('hrac1' + id1);
      const h2Select = document.getElementById('hrac2' + id1);
      const s1Input = document.getElementById('skore1' + id1);
      const s2Input = document.getElementById('skore2' + id1);
      const s3Input = document.getElementById('skore3' + id1);
      const s4Input = document.getElementById('skore4' + id1);

      const h1 = h1Select.value;
      const h2 = h2Select.value;
      const s1 = s1Input.value;
      const s2 = s2Input.value;
      const s3 = s3Input.value;
      const s4 = s4Input.value;
      let pocet = 0;	
    
      if (!h1 || !h2 || h1 === h2) return zobrazZpravu('Zvolte dva různé hráče!',true);//alert('');
      if (s1 === '' || s2 === '') return zobrazZpravu('Zadejte skóre prvního zápasu!',true);//alert('Zadejte skóre');
      if (s3 === '' || s4 === '') return zobrazZpravu('Zadejte skóre druhého zápasu!',true);

      let zapasy = JSON.parse(localStorage.getItem('zapasy') || '[]');
      zapasy.push({ h1, h2, s1, s2, s3, s4, skupina: id1 });
      localStorage.setItem('zapasy', JSON.stringify(zapasy));

      let pocetZapasu = JSON.parse(localStorage.getItem('pocetZapasu') || '[]');
      // Hledáme zápas podle hráčů a skupiny
      let zapas = pocetZapasu.find(z => z.jmeno === h1 || z.jmeno === h2 && z.skupina === id1);
      pocet = zapas.p1 + 1;
      pocetZapasu.push({ jmeno, pocet, skupina: id1 });

      // Uložíme zpět do localStorage
      localStorage.setItem('pocetZapasu', JSON.stringify(pocetZapasu));
      // Reset ComboBoxů a skóre
      h1Select.value = '';
      h2Select.value = '';
      s1Input.value = '';
      s2Input.value = '';
      s3Input.value = '';
      s4Input.value = '';
        // Zobraz info
      zobrazZpravu('Zápas uložen!');
      const hraci = getHraceFromLocalStorage();  // Načti hráče z localStorage
      zobrazStatistiky(hraci, 'Děti', 'statistikyDeti');
      zobrazStatistiky(hraci, 'Dospělí', 'statistikyDospelem');
    }

    function zobrazZpravu(text, jeChyba = false) {
      const div = document.getElementById('zpravaUlozeno');
      div.textContent = text;
      div.style.backgroundColor = jeChyba ? '#f44336' : '#4caf50'; // červená nebo zelená
      div.style.display = 'block';
    
      setTimeout(() => {
        div.style.display = 'none';
      }, 2000);
    }


    function toggleVysledky() {
      const vysledkyDiv = document.getElementById("vysledky");
      const tlacitko = document.getElementById("btnVysledky");

      if (vysledkyDiv.style.display === "block") {
        vysledkyDiv.style.display = "none";
        tlacitko.textContent = "Zobrazit výsledky";
      } else {
        zobrazVysledky();
        vysledkyDiv.style.display = "block";
        tlacitko.textContent = "Skrýt výsledky";
      }
    }

    function zobrazVysledky() {
      const zapasy = JSON.parse(localStorage.getItem('zapasy') || '[]');
      const statistikyA = {};
      const statistikyB = {};

      for (const z of zapasy) {
        const [cele1, cele2] = [z.h1, z.h2];
        const s1 = parseInt(z.s1) || 0;
        const s2 = parseInt(z.s2) || 0;
        const s3 = parseInt(z.s3) || 0;
        const s4 = parseInt(z.s4) || 0;

        const data1 = { jmeno: cele1, vyhry: 0, prohry: 0, body: s1 + s3 };
        const data2 = { jmeno: cele2, vyhry: 0, prohry: 0, body: s2 + s4 };

        if (s1+s3 > s2+s4) { data1.vyhry++; data2.prohry++; }
        else if (s2+s4 > s1+s3) { data2.vyhry++; data1.prohry++; }

        const stat = z.skupina === "A" ? statistikyA : statistikyB;
        stat[cele1] = merge(stat[cele1], data1);
        stat[cele2] = merge(stat[cele2], data2);
      }

      vykresliTabulku("tabulkaA", statistikyA);
      vykresliTabulku("tabulkaB", statistikyB);
    }


    function merge(puvodni, nove) {
      if (!puvodni) return { ...nove };
      return {
        jmeno: nove.jmeno,
        vyhry: puvodni.vyhry + nove.vyhry,
        prohry: puvodni.prohry + nove.prohry,
        body: puvodni.body + nove.body
      };
    }

    function vykresliTabulku(id, data) {
      const tbody = Object.values(data)
        .sort((a, b) => b.vyhry - a.vyhry || b.body - a.body); // seřazení podle výher, pak bodů
    
      let html = `<table class="turnaj-tabulka">
        <tr><th>Pořadí</th><th>Hráč</th><th>Výhry</th><th>Prohry</th><th>Body</th></tr>`;
    
      tbody.forEach((hrac, index) => {
        html += `<tr>
          <td>${index + 1}</td>
          <td>${hrac.jmeno}</td>
          <td>${hrac.vyhry}</td>
          <td>${hrac.prohry}</td>
          <td>${hrac.body}</td>
        </tr>`;
      });
    
      html += `</table>`;
      document.getElementById(id).innerHTML = html;
    }


    function merge(puvodni, nove) {
      if (!puvodni) return { ...nove };
      return {
        jmeno: nove.jmeno,
        vyhry: puvodni.vyhry + nove.vyhry,
        prohry: puvodni.prohry + nove.prohry,
        body: puvodni.body + nove.body
      };
    }

    function vykresliTabulku(id, data) {
      const tbody = Object.values(data)
        .sort((a, b) => b.vyhry - a.vyhry || b.body - a.body); // seřazení podle výher, pak bodů

      let html = "<tr><th>Pořadí</th><th>Hráč</th><th>Výhry</th><th>Prohry</th><th>Body</th></tr>";
      tbody.forEach((hrac, index) => {
        html += `<tr>
          <td>${index + 1}</td>
          <td>${hrac.jmeno }</td>
          <td>${hrac.vyhry}</td>
          <td>${hrac.prohry}</td>
          <td>${hrac.body}</td>
        </tr>`;
      });
      document.getElementById(id).innerHTML = html;
    }

    function zobraz(id) {
      document.querySelectorAll('.section').forEach(el => el.style.display = 'none');
      document.getElementById(id).style.display = 'flex';
      if (id === 'A' || id === 'B') naplnCombo(id.slice(-1));
    }

    function zpet() {
      document.querySelectorAll('.section').forEach(el => el.style.display = 'none');
    }
    //-------------------------------------------------------------------------------------------------------------------------
        // Funkce pro získání hráčů z localStorage
    function getHraceFromLocalStorage() {
      return JSON.parse(localStorage.getItem('hraci') || '[]');
    }

    // Funkce pro výpočet odehraných zápasů a zbývajících zápasů
    function spocitejZasluhy(hraci, skupinaId) {
      const zapasy = JSON.parse(localStorage.getItem('zapasy') || '[]');
      const hracStatistiky = {};

      // Filtruj hráče podle skupiny
      const hraciSkupina = hraci.filter(hrac => hrac.skupina === skupinaId);
      console.log(hraciSkupina);
      
      // Spočítání zápasů pro každýho hráče ve skupině
      hraciSkupina.forEach(hrac => {
        const odehrane = zapasy.filter(z => z.skupina === skupinaId && (z.h1 === hrac.jmeno || z.h2 === hrac.jmeno)).length;
        console.log(hrac.jmeno);
        const celkem = hraciSkupina.length - 1;
        hracStatistiky[hrac.prijmeni + ' ' + hrac.jmeno] = {
          odehral: odehrane,
          zbyva: Math.max(0, celkem - odehrane)
        };
      });

      return hracStatistiky;
    }

    // Funkce pro zobrazení statistik
    function zobrazStatistiky(hraci, skupinaId, tabulkaId) {
      const statistiky = spocitejZasluhy(hraci, skupinaId);
      const tbody = document.querySelector(`#${tabulkaId} tbody`);
      tbody.innerHTML = ''; // Smaže předchozí obsah

      // Vytvoření řádku pro každého hráče
      Object.entries(statistiky).forEach(([hrac, stat]) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${hrac}</td>
          <td>${stat.odehral}</td>
          <td>${stat.zbyva}</td>
        `;
        tbody.appendChild(row);
      });
    }

    // Spusť po načtení
    window.onload = () => {
      const hraci = getHraceFromLocalStorage();  // Načti hráče z localStorage
      zobrazStatistiky(hraci, 'Děti', 'statistikyDeti');
      zobrazStatistiky(hraci, 'Dospělí', 'statistikyDospelem');
      naplnCombo('Děti');
      naplnCombo('Dospělí');
    };

  </script>

  <div id="keyboard" class="keyboard">
  <div class="keyboard-row" id="row1"></div>
  <div class="keyboard-row" id="row2"></div>
  <div class="keyboard-row" id="row3"></div>
  <div class="keyboard-row" id="row4"></div>
  <div class="keyboard-row" id="row5"></div>
</div>

<script>
let activeInput = null;
let isShift = false;
let accentBuffer = '';

const accentMap = {
  'ˇ': {
    'c': 'č', 'C': 'Č', 'd': 'ď', 'D': 'Ď', 'e': 'ě', 'E': 'Ě',
    'n': 'ň', 'N': 'Ň', 'r': 'ř', 'R': 'Ř', 's': 'š', 'S': 'Š',
    't': 'ť', 'T': 'Ť', 'z': 'ž', 'Z': 'Ž'
  },
  '´': {
    'a': 'á', 'A': 'Á', 'e': 'é', 'E': 'É', 'i': 'í', 'I': 'Í',
    'o': 'ó', 'O': 'Ó', 'u': 'ú', 'U': 'Ú', 'y': 'ý', 'Y': 'Ý'
  }
};

const keys = {
  row1: [[';', '°'], ['+', '1'], ['ě', '2'], ['š', '3'], ['č', '4'], ['ř', '5'], ['ž', '6'], ['ý', '7'], ['á', '8'], ['í', '9'], ['é', '0'], ['=', '%'], ['´', 'ˇ'], ['BCK', 'BCK']],
  row2: [['q','Q'], ['w','W'], ['e','E'], ['r','R'], ['t','T'], ['z','Z'], ['u','U'], ['i','I'], ['o','O'], ['p','P'], ['ú','/'], [')','(']],
  row3: [['a','A'], ['s','S'], ['d','D'], ['f','F'], ['g','G'], ['h','H'], ['j','J'], ['k','K'], ['l','L'], ['ů','"'], ['§','!'], ['¨','"']],
  row4: [['\\','|'], ['y','Y'], ['x','X'], ['c','C'], ['v','V'], ['b','B'], ['n','N'], ['m','M'], [',','?'], ['.',':'], ['-','_']],
  row5: [['SHIFT','SHIFT'], [' ',' '], ['SHIFT','SHIFT'], ['ZAVRIT','ZAVRIT']]
};

function createRow(rowElement, keyDefs) {
  keyDefs.forEach(([normal, shift]) => {
    const btn = document.createElement("button");
    btn.textContent = isShift ? shift : normal;
    if (normal === ' ' || normal === 'SHIFT' || normal === 'ZAVRIT') btn.classList.add('wide');
    if (normal === ' ') btn.classList.add('extra-wide');
    btn.onclick = (e) => {
      e.stopPropagation();
      handleKeyPress(normal, shift);
    };
    rowElement.appendChild(btn);
  });
}

function handleKeyPress(normal, shift) {
  const char = isShift ? shift : normal;
  switch (normal) {
    case 'BCK':
      if (activeInput) activeInput.value = activeInput.value.slice(0, -1);
      break;
    case 'SHIFT':
      isShift = !isShift;
      refreshKeyboard();
      break;
    case 'ZAVRIT':
      keyboard.classList.remove("visible");
      break;
    case ' ':
      if (activeInput) activeInput.value += ' ';
      break;
    default:
      if (!activeInput) return;
      if (accentBuffer && accentMap[accentBuffer] && accentMap[accentBuffer][char]) {
        activeInput.value += accentMap[accentBuffer][char];
        accentBuffer = '';
      } else if (accentMap[char]) {
        accentBuffer = char;
      } else {
        activeInput.value += char;
        accentBuffer = '';
      }
      if (isShift && normal !== 'SHIFT') {
        isShift = false;
        refreshKeyboard();
      }
  }
}



function refreshKeyboard() {
  const keys = keyboardType === 'number' ? keysNumber : keysText;
  createRow(document.getElementById("row1"), keys.row1);
  createRow(document.getElementById("row2"), keys.row2);
  createRow(document.getElementById("row3"), keys.row3);
  createRow(document.getElementById("row4"), keys.row4);
  createRow(document.getElementById("row5"), keys.row5);
}

const keyboard = document.getElementById("keyboard");

document.querySelectorAll('input').forEach(input => {
  input.addEventListener("focus", (e) => {
    activeInput = e.target;
    keyboardType = input.type === 'number' ? 'number' : 'text';
    keyboard.classList.add("visible");
    refreshKeyboard();
  });
});

document.addEventListener("click", (e) => {
  if (!keyboard.contains(e.target) && !(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA')) {
    keyboard.classList.remove("visible");
    activeInput = null;
  }
});


refreshKeyboard();
</script>

</body>

</html>